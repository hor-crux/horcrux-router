var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
define(["require", "exports", 'horcrux-flux', './routestatic', './route'], function (require, exports, horcrux_flux_1, routestatic_1, route_1) {
    var Router = (function (_super) {
        __extends(Router, _super);
        function Router() {
            _super.call(this);
            //INSTANCE
            this.routes = [];
            this.views = [];
            Router._static.addRouter(this);
        }
        Router.prototype.addView = function (view) {
            this.views.push(view);
            Router._static.route(window.location.hash.substring(1), false, this, view.name);
        };
        Router.prototype.removeView = function (view) {
            this.views.splice(this.views.indexOf(view), 1);
        };
        Router.prototype.config = function (routeConfig) {
            this.routes.push(new route_1.default(routeConfig));
        };
        Router.prototype.beforeRoute = function (url) {
            var route = this.findRoute(url);
            if (!!route && !!route.redirect)
                return Promise.reject(route.redirect);
            else
                return Promise.resolve('');
        };
        /**
         * iterates over all registered views and asks them to deactivate
         */
        Router.prototype.canDeactivate = function (url, viewName) {
            var route = this.findRoute(url);
            if (!route)
                return Promise.resolve('');
            return Promise.all(this.views
                .filter(function (view) {
                return !viewName || view.name === viewName;
            })
                .map(function (view) {
                return view.canDeavtivate(route.getComponentSelector(view.name), route.getArgs(url));
            }));
        };
        /**
         * iterates over all registered views and asks them to activate
         */
        Router.prototype.canActivate = function (url, viewName) {
            var route = this.findRoute(url);
            if (!route)
                return Promise.resolve('');
            return Promise.all(this.views
                .filter(function (view) {
                return !viewName || view.name === viewName;
            })
                .map(function (view) {
                return view.canAvtivate(route.getComponentSelector(view.name), route.getArgs(url));
            }));
        };
        /**
         * iterates over all registered views activate the new component
         */
        Router.prototype.activate = function (url, viewName) {
            var route = this.findRoute(url);
            if (!route)
                return void 0;
            this.views
                .filter(function (view) {
                return !viewName || view.name === viewName;
            })
                .forEach(function (view) {
                view.activate(route.getComponentSelector(view.name), route.getArgs(url));
            });
        };
        Router.prototype.findRoute = function (url) {
            for (var key in this.routes) {
                var route = this.routes[key];
                if (route.matches(url))
                    return route;
            }
            return void 0;
        };
        // STATIC
        Router._static = new routestatic_1.default();
        return Router;
    })(horcrux_flux_1.Store);
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = Router;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlci9yb3V0ZXIudHMiXSwibmFtZXMiOlsiUm91dGVyIiwiUm91dGVyLmNvbnN0cnVjdG9yIiwiUm91dGVyLmFkZFZpZXciLCJSb3V0ZXIucmVtb3ZlVmlldyIsIlJvdXRlci5jb25maWciLCJSb3V0ZXIuYmVmb3JlUm91dGUiLCJSb3V0ZXIuY2FuRGVhY3RpdmF0ZSIsIlJvdXRlci5jYW5BY3RpdmF0ZSIsIlJvdXRlci5hY3RpdmF0ZSIsIlJvdXRlci5maW5kUm91dGUiXSwibWFwcGluZ3MiOiI7Ozs7OztJQU9BO1FBQW9DQSwwQkFBWUE7UUFVL0NBO1lBQ0NDLGlCQUFPQSxDQUFDQTtZQUxUQSxVQUFVQTtZQUNBQSxXQUFNQSxHQUFpQkEsRUFBRUEsQ0FBQ0E7WUFDMUJBLFVBQUtBLEdBQWtCQSxFQUFFQSxDQUFDQTtZQUluQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDaENBLENBQUNBO1FBRU1ELHdCQUFPQSxHQUFkQSxVQUFlQSxJQUFXQTtZQUN6QkUsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLEtBQUtBLEVBQUVBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUFBO1FBQ2hGQSxDQUFDQTtRQUVNRiwyQkFBVUEsR0FBakJBLFVBQWtCQSxJQUFXQTtZQUM1QkcsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDaERBLENBQUNBO1FBRU1ILHVCQUFNQSxHQUFiQSxV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QUFEQSxDQXBHQSxBQW9HQ0EsRUFwR21DLG9CQUFLLEVBb0d4QztJQXBHRDs0QkFvR0MsQ0FBQSIsImZpbGUiOiJyb3V0ZXIvcm91dGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTdG9yZSwgaGFuZGxlfSBmcm9tICdob3JjcnV4LWZsdXgnXG5pbXBvcnQge0lSb3V0ZUNvbmZpZ30gZnJvbSAnLi9yb3V0ZWNvbmZpZydcbmltcG9ydCBSb3V0ZVN0YXRpYyBmcm9tICcuL3JvdXRlc3RhdGljJ1xuaW1wb3J0IFJvdXRlIGZyb20gJy4vcm91dGUnO1xuaW1wb3J0IFJvdXRlQWN0aW9ucyBmcm9tICcuL2FjdGlvbnMnXG5pbXBvcnQgSGNWaWV3IGZyb20gJy4uL3ZpZXcnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJvdXRlciBleHRlbmRzIFN0b3JlPFJvdXRlPiB7XG5cdFxuXHQvLyBTVEFUSUNcblx0c3RhdGljIF9zdGF0aWMgPSBuZXcgUm91dGVTdGF0aWMoKTtcblx0XG5cdFxuXHQvL0lOU1RBTkNFXG5cdHByb3RlY3RlZCByb3V0ZXM6IEFycmF5PFJvdXRlPiA9IFtdO1xuXHRwcm90ZWN0ZWQgdmlld3M6IEFycmF5PEhjVmlldz4gPSBbXTtcblx0XG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdHN1cGVyKCk7XG5cdFx0Um91dGVyLl9zdGF0aWMuYWRkUm91dGVyKHRoaXMpO1xuXHR9XG5cdFxuXHRwdWJsaWMgYWRkVmlldyh2aWV3OkhjVmlldyk6IHZvaWQge1xuXHRcdHRoaXMudmlld3MucHVzaCh2aWV3KTtcblx0XHRSb3V0ZXIuX3N0YXRpYy5yb3V0ZSh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSksIGZhbHNlLCB0aGlzLCB2aWV3Lm5hbWUpXG5cdH1cblx0XG5cdHB1YmxpYyByZW1vdmVWaWV3KHZpZXc6SGNWaWV3KTogdm9pZCB7XG5cdFx0dGhpcy52aWV3cy5zcGxpY2UodGhpcy52aWV3cy5pbmRleE9mKHZpZXcpLCAxKTtcblx0fVxuXHRcblx0cHVibGljIGNvbmZpZyhyb3V0ZUNvbmZpZzpJUm91dGVDb25maWcpOiB2b2lkIHtcblx0XHR0aGlzLnJvdXRlcy5wdXNoKG5ldyBSb3V0ZShyb3V0ZUNvbmZpZykpO1xuXHR9XG5cdFxuXHRwdWJsaWMgYmVmb3JlUm91dGUodXJsOnN0cmluZyk6IFByb21pc2U8YW55PiB7XG5cdFx0bGV0IHJvdXRlID0gdGhpcy5maW5kUm91dGUodXJsKTtcblx0XHRpZighIXJvdXRlICYmICEhcm91dGUucmVkaXJlY3QpXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3Qocm91dGUucmVkaXJlY3QpXG5cdFx0ZWxzZVxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSgnJyk7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBpdGVyYXRlcyBvdmVyIGFsbCByZWdpc3RlcmVkIHZpZXdzIGFuZCBhc2tzIHRoZW0gdG8gZGVhY3RpdmF0ZVxuXHQgKi9cblx0cHVibGljIGNhbkRlYWN0aXZhdGUodXJsOnN0cmluZywgdmlld05hbWU/OnN0cmluZyk6IFByb21pc2U8YW55PiB7XG5cdFx0bGV0IHJvdXRlID0gdGhpcy5maW5kUm91dGUodXJsKTtcblx0XHRpZighcm91dGUpXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCcnKVxuXHRcdFx0XG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKFxuXHRcdFx0dGhpcy52aWV3c1xuXHRcdFx0LmZpbHRlcih2aWV3ID0+IHtcblx0XHRcdFx0cmV0dXJuICF2aWV3TmFtZSB8fCB2aWV3Lm5hbWUgPT09IHZpZXdOYW1lO1xuXHRcdFx0fSlcblx0XHRcdC5tYXAodmlldyA9PiB7XG5cdFx0XHRcdHJldHVybiB2aWV3LmNhbkRlYXZ0aXZhdGUocm91dGUuZ2V0Q29tcG9uZW50U2VsZWN0b3Iodmlldy5uYW1lKSwgcm91dGUuZ2V0QXJncyh1cmwpKVxuXHRcdFx0fSlcblx0XHQpO1xuXHR9XG5cdFxuXHQvKipcblx0ICogaXRlcmF0ZXMgb3ZlciBhbGwgcmVnaXN0ZXJlZCB2aWV3cyBhbmQgYXNrcyB0aGVtIHRvIGFjdGl2YXRlXG5cdCAqL1xuXHRwdWJsaWMgY2FuQWN0aXZhdGUodXJsOnN0cmluZywgdmlld05hbWU/OnN0cmluZyk6IFByb21pc2U8YW55PiB7XG5cdFx0bGV0IHJvdXRlID0gdGhpcy5maW5kUm91dGUodXJsKTtcblx0XHRpZighcm91dGUpXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCcnKVxuXHRcdFx0XG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKFxuXHRcdFx0dGhpcy52aWV3c1xuXHRcdFx0LmZpbHRlcih2aWV3ID0+IHtcblx0XHRcdFx0cmV0dXJuICF2aWV3TmFtZSB8fCB2aWV3Lm5hbWUgPT09IHZpZXdOYW1lO1xuXHRcdFx0fSlcblx0XHRcdC5tYXAodmlldyA9PiB7XG5cdFx0XHRcdHJldHVybiB2aWV3LmNhbkF2dGl2YXRlKHJvdXRlLmdldENvbXBvbmVudFNlbGVjdG9yKHZpZXcubmFtZSksIHJvdXRlLmdldEFyZ3ModXJsKSk7XG5cdFx0XHR9KVxuXHRcdCk7XG5cdH1cblx0XG5cdC8qKlxuXHQgKiBpdGVyYXRlcyBvdmVyIGFsbCByZWdpc3RlcmVkIHZpZXdzIGFjdGl2YXRlIHRoZSBuZXcgY29tcG9uZW50XG5cdCAqL1xuXHRwdWJsaWMgYWN0aXZhdGUodXJsOnN0cmluZywgdmlld05hbWU/OnN0cmluZyk6IHZvaWQge1xuXHRcdGxldCByb3V0ZSA9IHRoaXMuZmluZFJvdXRlKHVybCk7XG5cdFx0aWYoIXJvdXRlKVxuXHRcdFx0cmV0dXJuIHZvaWQgMDtcblx0XHRcdFxuXHRcdHRoaXMudmlld3Ncblx0XHQuZmlsdGVyKHZpZXcgPT4ge1xuXHRcdFx0cmV0dXJuICF2aWV3TmFtZSB8fCB2aWV3Lm5hbWUgPT09IHZpZXdOYW1lO1xuXHRcdH0pXG5cdFx0LmZvckVhY2godmlldyA9PiB7XG5cdFx0XHR2aWV3LmFjdGl2YXRlKHJvdXRlLmdldENvbXBvbmVudFNlbGVjdG9yKHZpZXcubmFtZSksIHJvdXRlLmdldEFyZ3ModXJsKSk7XG5cdFx0fSlcblx0fVxuXHRcblx0cHJvdGVjdGVkIGZpbmRSb3V0ZSh1cmw6c3RyaW5nKTogUm91dGUge1xuXHRcdGZvcihsZXQga2V5IGluIHRoaXMucm91dGVzKSB7XG5cdFx0XHRsZXQgcm91dGUgPSB0aGlzLnJvdXRlc1trZXldO1xuXHRcdFx0aWYocm91dGUubWF0Y2hlcyh1cmwpKVxuXHRcdFx0XHRyZXR1cm4gcm91dGU7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiB2b2lkIDA7XG5cdH1cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
